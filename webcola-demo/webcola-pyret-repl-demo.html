<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combined Input Component Demo</title>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Combined Input Component Demo</h1>
        <p>This demo shows the Combined Input Component with REPL, Layout Interface, and Graph visualization.</p>
        
        <button onclick="setupCombinedInputDemo()">Start Demo</button>
        <button onclick="clearCombinedInputDemo()">Clear Demo</button>
        
        <div id="combined-input-demo-container" style="height: 800px; border: 1px solid #ddd; border-radius: 8px; margin: 15px 0;">
            <div style="padding: 40px; text-align: center; color: #666;">
                <h3>Combined Input Component</h3>
                <p>Click "Start Demo" to see the Combined Input Component</p>
            </div>
        </div>
    </div>

    <!-- CnD Core Library (browser build) -->
    <script src="../dist/browser/cnd-core-complete.global.js"></script>
    <link rel="stylesheet" href="../dist/browser/cnd-core-complete.css">

    <script>
        /**
         * Set up the Combined Input Component demo
         */
        function setupCombinedInputDemo() {
            console.log('üöÄ Setting up Combined Input Component demo...');
            
            // Clear existing content
            clearCombinedInputDemo();
            
            // Check for external evaluator
            const externalEvaluator = window.__internalRepl || window.pyretREPLInternal;
            
            // Create empty data instance (no initial data)
            const dataInstance = new window.CndCore.PyretDataInstance({
                dict: {},
                brands: {}
            });
            
            // Simple CnD specification
            const cndSpec = `nodes:
  - { id: "atom", type: "atom", color: "#4CAF50" }
edges:
  - { id: "relation", type: "relation", color: "#2196F3" }`;

            // Mount the combined input component
            const success = window.CndCore.mountCombinedInput({
                containerId: 'combined-input-demo-container',
                cndSpec: cndSpec,
                dataInstance: dataInstance,
                pyretEvaluator: externalEvaluator || createMockEvaluator(),
                height: '800px',
                showLayoutInterface: true,
                autoApplyLayout: true,
                onInstanceChange: (instance) => {
                    console.log('üîÑ Data updated:', {
                        atoms: instance.getAtoms().length,
                        relations: instance.getRelations().length
                    });
                },
                onSpecChange: (spec) => {
                    console.log('üìê Layout spec updated');
                },
                onLayoutApplied: (layout) => {
                    console.log('üé® Layout applied');
                }
            });
            
            if (success) {
                console.log('‚úÖ Combined Input Component demo ready!');
            } else {
                console.error('‚ùå Failed to setup Combined Input Component demo');
            }
        }

        /**
         * Clear the combined input demo
         */
        function clearCombinedInputDemo() {
            const container = document.getElementById('combined-input-demo-container');
            if (container) {
                container.innerHTML = `
                    <div style="padding: 40px; text-align: center; color: #666;">
                        <h3>Combined Input Component</h3>
                        <p>Click "Start Demo" to see the Combined Input Component</p>
                    </div>
                `;
            }
        }

        /**
         * Create a mock evaluator for demo purposes
         */
        function createMockEvaluator() {
            return {
                run: async (code, sourceLocation) => {
                    console.log(`Mock evaluator running: ${code}`);
                    return {
                        success: true,
                        result: {
                            dict: { value: Math.random() * 100 },
                            brands: { '$brandmock': true }
                        }
                    };
                },
                runtime: {
                    isSuccessResult: (result) => result.success === true
                }
            };
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Combined Input Component demo page loaded');
        });
    </script>
</body>
</html>