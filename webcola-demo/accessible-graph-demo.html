<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accessible WebCola Graph Demo</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        
        .main-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .panel {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .graph-container {
            height: 700px;
            position: relative;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .accessibility-info {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 16px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        .accessibility-info h3 {
            margin-top: 0;
            color: #1565C0;
            font-size: 18px;
        }
        
        .accessibility-info ul {
            margin-bottom: 0;
            padding-left: 20px;
        }
        
        .accessibility-info li {
            margin-bottom: 8px;
        }
        
        .keyboard-shortcuts {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 16px;
            margin-top: 20px;
            border-radius: 4px;
        }
        
        .keyboard-shortcuts h4 {
            margin-top: 0;
            color: #856404;
            font-size: 16px;
        }
        
        .keyboard-shortcuts kbd {
            background: #424242;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-family: monospace;
            margin: 0 4px;
        }
        
        .controls-panel {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .btn-accessibility {
            background: #4CAF50;
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.3s;
        }
        
        .btn-accessibility:hover {
            background: #45a049;
        }
        
        .description-output {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: 1px solid #dee2e6;
        }
        
        .screen-reader-only {
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 12px;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 16px;
            margin-bottom: 24px;
        }
        
        .feature-badge {
            display: inline-block;
            background: #e8f5e9;
            color: #2e7d32;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>üéØ Accessible Graph Visualization Demo</h1>
    <p class="subtitle">
        Demonstrating visual accessibility features for graph visualizations
    </p>
    
    <div class="accessibility-info">
        <h3>üîä Accessibility Features</h3>
        <ul>
            <li><strong>Screen Reader Support:</strong> Full ARIA labels and descriptions for all graph elements</li>
            <li><strong>Keyboard Navigation:</strong> Navigate between nodes using arrow keys</li>
            <li><strong>Live Announcements:</strong> Real-time updates announced to assistive technologies</li>
            <li><strong>Alternative Text Descriptions:</strong> Comprehensive text descriptions of graph structure</li>
            <li><strong>High Contrast:</strong> Visual indicators for focused elements</li>
        </ul>
    </div>
    
    <div class="main-container">
        <!-- Controls Panel -->
        <div class="panel">
            <h2 style="font-size: 20px; margin-bottom: 16px;">Controls</h2>
            
            <div class="controls-panel">
                <button class="btn btn-primary" onclick="loadSampleGraph()">
                    üìä Load Sample Graph
                </button>
                
                <button class="btn-accessibility" onclick="generateDescription('brief')">
                    üìù Get Brief Description
                </button>
                
                <button class="btn-accessibility" onclick="generateDescription('detailed')">
                    üìÑ Get Detailed Description
                </button>
                
                <button class="btn-accessibility" onclick="generateDescription('full')">
                    üìö Get Full Description
                </button>
                
                <button class="btn btn-secondary" onclick="listAllNodes()">
                    üîç List All Nodes
                </button>
                
                <button class="btn btn-secondary" onclick="listAllEdges()">
                    üîó List All Edges
                </button>
                
                <button class="btn btn-warning" onclick="clearDescription()">
                    üóëÔ∏è Clear Output
                </button>
            </div>
            
            <div class="keyboard-shortcuts">
                <h4>‚å®Ô∏è Keyboard Shortcuts</h4>
                <ul style="padding-left: 20px; margin: 8px 0;">
                    <li><kbd>Tab</kbd> Focus on graph</li>
                    <li><kbd>‚Üë</kbd><kbd>‚Üì</kbd><kbd>‚Üê</kbd><kbd>‚Üí</kbd> Navigate nodes</li>
                    <li><kbd>Enter</kbd> / <kbd>Space</kbd> Node details</li>
                    <li><kbd>Esc</kbd> Exit navigation</li>
                </ul>
            </div>
        </div>
        
        <!-- Graph Panel -->
        <div class="panel">
            <h2 style="font-size: 20px; margin-bottom: 16px;">
                Graph Visualization 
                <span class="feature-badge">‚ôø Accessible</span>
            </h2>
            
            <div id="graph-container" class="graph-container">
                <!-- WebCola graph will be rendered here -->
                <webcola-cnd-graph 
                    id="accessible-graph"
                    width="800" 
                    height="650"
                    layoutFormat="default"
                    aria-label="Interactive graph visualization"
                    role="application">
                </webcola-cnd-graph>
            </div>
        </div>
    </div>
    
    <!-- Output Panel -->
    <div class="panel">
        <h2 style="font-size: 20px; margin-bottom: 16px;">üìã Description Output</h2>
        <div id="description-output" class="description-output">
            Click a button above to generate an accessible description of the graph.
        </div>
    </div>
    
    <!-- ARIA Live Region for Announcements -->
    <div id="aria-live" role="status" aria-live="polite" aria-atomic="true" class="screen-reader-only"></div>
    
    <!-- D3 v4 and WebCola -->
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="../vendor/cola.js"></script>
    
    <!-- SpyTial Core bundle -->
    <script src="../dist/browser/spytial-core-complete.global.js"></script>
    
    <script>
        let graphElement = null;
        let currentLayout = null;
        
        /**
         * Announces a message to screen readers
         */
        function announceToScreenReader(message) {
            const liveRegion = document.getElementById('aria-live');
            liveRegion.textContent = '';
            setTimeout(() => {
                liveRegion.textContent = message;
            }, 100);
        }
        
        /**
         * Loads a sample graph for demonstration
         */
        async function loadSampleGraph() {
            announceToScreenReader('Loading sample graph...');
            
            // Create sample data
            const sampleAlloyXML = `
                <alloy>
                    <instance>
                        <sig label="Node">
                            <atom label="A"/>
                            <atom label="B"/>
                            <atom label="C"/>
                            <atom label="D"/>
                            <atom label="E"/>
                        </sig>
                        <field label="next" parentID="Node">
                            <tuple> <atom label="A"/> <atom label="B"/> </tuple>
                            <tuple> <atom label="B"/> <atom label="C"/> </tuple>
                            <tuple> <atom label="C"/> <atom label="D"/> </tuple>
                            <tuple> <atom label="D"/> <atom label="E"/> </tuple>
                            <tuple> <atom label="E"/> <atom label="A"/> </tuple>
                        </field>
                        <field label="friend" parentID="Node">
                            <tuple> <atom label="A"/> <atom label="C"/> </tuple>
                            <tuple> <atom label="B"/> <atom label="D"/> </tuple>
                        </field>
                    </instance>
                </alloy>
            `;
            
            const sampleCND = `
                layout:
                  - left: A
                  - top: B
                  - right: C
            `;
            
            try {
                // Parse Alloy XML
                const alloyDatum = CndCore.AlloyInstance.parseAlloyXML(sampleAlloyXML);
                const alloyDataInstance = new CndCore.AlloyDataInstance(alloyDatum.instances[0]);
                
                // Create evaluator
                const evaluationContext = { sourceData: sampleAlloyXML };
                const forgeEvaluator = new CndCore.ForgeEvaluator();
                forgeEvaluator.initialize(evaluationContext);
                
                // Parse layout spec
                const layoutSpec = CndCore.parseLayoutSpec(sampleCND);
                
                // Create layout instance
                const layoutInstance = new CndCore.LayoutInstance(
                    layoutSpec,
                    forgeEvaluator,
                    0,
                    true
                );
                
                // Generate layout
                const layoutResult = layoutInstance.generateLayout(alloyDataInstance, {});
                currentLayout = layoutResult.layout;
                
                // Render
                graphElement = document.getElementById('accessible-graph');
                await graphElement.renderLayout(currentLayout);
                
                announceToScreenReader(`Sample graph loaded successfully. Graph contains ${currentLayout.nodes.length} nodes and ${currentLayout.links.length} edges. Press Tab to focus on the graph and use arrow keys to navigate.`);
                
                // Show brief description
                generateDescription('brief');
            } catch (error) {
                console.error('Error loading sample graph:', error);
                announceToScreenReader(`Error loading sample graph: ${error.message}`);
                alert(`Error loading sample graph: ${error.message}`);
            }
        }
        
        /**
         * Generates an accessible description of the graph
         */
        function generateDescription(verbosity) {
            if (!graphElement) {
                alert('Please load a graph first');
                return;
            }
            
            const description = graphElement.getAccessibleGraphDescription(verbosity);
            const output = document.getElementById('description-output');
            output.textContent = description;
            
            announceToScreenReader(`Generated ${verbosity} description with ${description.length} characters`);
        }
        
        /**
         * Lists all nodes in the graph
         */
        function listAllNodes() {
            if (!graphElement) {
                alert('Please load a graph first');
                return;
            }
            
            const nodes = graphElement.getAccessibleNodeDescriptions();
            let output = `Graph contains ${nodes.length} nodes:\n\n`;
            
            nodes.forEach((node, index) => {
                output += `${index + 1}. ${node.label}\n`;
                output += `   Type: ${node.type}\n`;
                output += `   Position: (${node.position.x}, ${node.position.y})\n`;
                output += `   Connections: ${node.connections.incoming} incoming, ${node.connections.outgoing} outgoing\n\n`;
            });
            
            document.getElementById('description-output').textContent = output;
            announceToScreenReader(`Listed ${nodes.length} nodes`);
        }
        
        /**
         * Lists all edges in the graph
         */
        function listAllEdges() {
            if (!graphElement) {
                alert('Please load a graph first');
                return;
            }
            
            const edges = graphElement.getAccessibleEdgeDescriptions();
            let output = `Graph contains ${edges.length} edges:\n\n`;
            
            edges.forEach((edge, index) => {
                output += `${index + 1}. ${edge.source} ‚Üí ${edge.target}\n`;
                output += `   Label: ${edge.label}\n`;
                output += `   Type: ${edge.type}\n\n`;
            });
            
            document.getElementById('description-output').textContent = output;
            announceToScreenReader(`Listed ${edges.length} edges`);
        }
        
        /**
         * Clears the description output
         */
        function clearDescription() {
            document.getElementById('description-output').textContent = 'Click a button above to generate an accessible description of the graph.';
            announceToScreenReader('Description output cleared');
        }
        
        // Initialize on page load
        window.addEventListener('load', () => {
            announceToScreenReader('Accessible graph visualization demo loaded. Click "Load Sample Graph" to begin.');
        });
    </script>
</body>
</html>
