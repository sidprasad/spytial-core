<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edge Input Mode Demo</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            margin: 20px;
        }
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .instructions {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .instructions h3 {
            margin-top: 0;
        }
        .instructions ul {
            margin: 10px 0;
        }
        .instructions li {
            margin: 5px 0;
        }
        .status {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1>ðŸŽ¯ Edge Input Mode Demo</h1>
        
        <div class="instructions">
            <h3>How to Use Edge Input Mode:</h3>
            <ul>
                <li><strong>Activate Input Mode:</strong> Hold Cmd (Mac) or Ctrl (Windows/Linux)</li>
                <li><strong>Create Edge:</strong> While in input mode, click and drag from one node to another</li>
                <li><strong>Edit Edge:</strong> While in input mode, click on an existing edge to edit its label</li>
                <li><strong>Visual Feedback:</strong> Notice the cursor changes to crosshair when input mode is active</li>
            </ul>
        </div>
        
        <div class="status" id="status">
            Input Mode: <span id="mode-status">Inactive</span>
        </div>
        
        <button id="load-sample" onclick="loadSampleGraph()">Load Sample Graph</button>
        
        <!-- Use the webcola-cnd-graph custom element -->
        <webcola-cnd-graph 
            id="graph-container"
            width="800" 
            height="600"
            layoutFormat="default">
        </webcola-cnd-graph>
    </div>

    <!-- Load the CND Core library -->
    <script src="./dist/browser/cnd-core-complete.global.js"></script>
    
    <script>
        // Initialize status tracking
        const statusElement = document.getElementById('mode-status');
        const graphContainer = document.getElementById('graph-container');
        
        // Listen for input mode events
        graphContainer.addEventListener('input-mode-activated', () => {
            statusElement.textContent = 'Active (Hold Cmd/Ctrl)';
            statusElement.style.color = '#4caf50';
            statusElement.style.fontWeight = 'bold';
        });
        
        graphContainer.addEventListener('input-mode-deactivated', () => {
            statusElement.textContent = 'Inactive';
            statusElement.style.color = '#666';
            statusElement.style.fontWeight = 'normal';
        });
        
        // Listen for edge creation and modification events
        graphContainer.addEventListener('edge-created', (event) => {
            console.log('Edge created:', event.detail);
            alert(`Edge created: "${event.detail.edge.label}" from ${event.detail.sourceNode.label} to ${event.detail.targetNode.label}`);
        });
        
        graphContainer.addEventListener('edge-modified', (event) => {
            console.log('Edge modified:', event.detail);
            alert(`Edge label changed from "${event.detail.oldLabel}" to "${event.detail.newLabel}"`);
        });
        
        // Load a sample graph
        function loadSampleGraph() {
            // Create sample YAML layout specification
            const sampleYaml = `
atoms:
  - id: A
    type: Node
    label: Node A
  - id: B
    type: Node  
    label: Node B
  - id: C
    type: Node
    label: Node C

relations:
  - id: connects
    name: connects
    tuples:
      - [A, B]
      - [B, C]

types:
  - id: Node
    atoms: [A, B, C]
`;
            
            try {
                // Create data instance from YAML
                const dataInstance = window.CnDCore.JSONDataInstance.fromYAML(sampleYaml);
                
                // Create layout specification
                const layoutSpec = {
                    name: "Sample Layout",
                    projections: [
                        {
                            name: "default",
                            relationMap: {
                                connects: {
                                    edgeLabel: "label",
                                    edgeColor: "#333"
                                }
                            },
                            nodeMap: {
                                Node: {
                                    nodeLabel: "label",
                                    nodeColor: "#lightblue"
                                }
                            }
                        }
                    ]
                };
                
                // Create layout instance
                const layout = window.CnDCore.LayoutInstance.fromDataInstanceAndLayoutSpec(
                    dataInstance, 
                    layoutSpec, 
                    "default"
                );
                
                // Render the graph
                graphContainer.renderLayout(layout);
                
            } catch (error) {
                console.error('Error loading sample graph:', error);
                alert('Error loading sample graph. Check console for details.');
            }
        }
        
        // Load sample graph on page load
        window.addEventListener('load', () => {
            setTimeout(loadSampleGraph, 100);
        });
    </script>
</body>
</html>