<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prominent Attributes Demo - CnD Core</title>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .demo-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .demo-section {
            margin-bottom: 30px;
        }
        h1, h2 {
            color: #2c3e50;
        }
        .description {
            background: #e8f4fd;
            border-left: 4px solid #007acc;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .graph-container {
            width: 100%;
            height: 400px;
            border: 2px solid #007acc;
            border-radius: 8px;
            margin: 20px 0;
            background: white;
        }
        .example-code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
        }
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .comparison-item h3 {
            color: #495057;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1>üè∑Ô∏è Prominent Attributes Demo</h1>
        
        <div class="description">
            <h3>‚ú® New Feature: Relative Attribute Sizing</h3>
            <p>This demo showcases the new prominent attribute functionality that allows you to:</p>
            <ul>
                <li><strong>Make specific attributes more prominent</strong> than the main CnD node label</li>
                <li><strong>Automatically reduce main label size</strong> when prominent attributes exist</li>
                <li><strong>Sort attributes alphabetically</strong> by key for better consistency</li>
                <li><strong>Apply bold styling</strong> to prominent attributes for better visual hierarchy</li>
            </ul>
        </div>

        <div class="demo-section">
            <h2>üìä Comparison: Before vs After</h2>
            
            <div class="comparison-grid">
                <div class="comparison-item">
                    <h3>Before (Standard Attributes)</h3>
                    <div class="example-code">
# Standard Layout Spec
directives:
  - attribute:
      field: name
  - attribute:
      field: age
  - attribute:
      field: department</div>
                    <div id="graph-standard" class="graph-container"></div>
                </div>

                <div class="comparison-item">
                    <h3>After (With Prominent Attributes)</h3>
                    <div class="example-code">
# Enhanced Layout Spec
directives:
  - attribute:
      field: name
      prominent: true  # ‚Üê New!
  - attribute:
      field: age
  - attribute:
      field: department</div>
                    <div id="graph-prominent" class="graph-container"></div>
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h2>üîß Implementation Details</h2>
            
            <div class="description">
                <h4>What Changed:</h4>
                <ul>
                    <li><strong>AttributeDirective Interface</strong>: Added optional <code>prominent?: boolean</code> field</li>
                    <li><strong>LayoutNode Interface</strong>: Updated attributes from <code>Record&lt;string, string[]&gt;</code> to <code>Record&lt;string, AttributeMetadata&gt;</code></li>
                    <li><strong>Rendering Logic</strong>: Enhanced WebColaCnDGraph to handle prominence and alphabetical sorting</li>
                    <li><strong>Visual Hierarchy</strong>: Prominent attributes use larger font size and bold weight</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="./dist/browser/cnd-core-complete.global.js"></script>
    <script>
        // Sample data for demonstration
        const sampleData = {
            atoms: [
                { id: 'Employee1', type: 'Person', label: 'Alice Johnson' },
                { id: 'Employee2', type: 'Person', label: 'Bob Smith' },
                { id: 'Dept1', type: 'Department', label: 'Engineering' },
                { id: 'Age1', type: 'Age', label: '28' },
                { id: 'Age2', type: 'Age', label: '34' },
                { id: 'Name1', type: 'Name', label: 'Alice' },
                { id: 'Name2', type: 'Name', label: 'Bob' }
            ],
            relations: [
                {
                    id: 'name_rel1',
                    name: 'name',
                    types: ['Person', 'Name'],
                    tuples: [
                        { atoms: ['Employee1', 'Name1'], types: ['Person', 'Name'] },
                        { atoms: ['Employee2', 'Name2'], types: ['Person', 'Name'] }
                    ]
                },
                {
                    id: 'age_rel1',
                    name: 'age',
                    types: ['Person', 'Age'],
                    tuples: [
                        { atoms: ['Employee1', 'Age1'], types: ['Person', 'Age'] },
                        { atoms: ['Employee2', 'Age2'], types: ['Person', 'Age'] }
                    ]
                },
                {
                    id: 'dept_rel1',
                    name: 'department',
                    types: ['Person', 'Department'],
                    tuples: [
                        { atoms: ['Employee1', 'Dept1'], types: ['Person', 'Department'] },
                        { atoms: ['Employee2', 'Dept1'], types: ['Person', 'Department'] }
                    ]
                }
            ]
        };

        // Standard layout spec (no prominent attributes)
        const standardLayoutSpec = `
directives:
  - attribute:
      field: name
  - attribute:
      field: age
  - attribute:
      field: department
`;

        // Enhanced layout spec (with prominent attributes)
        const prominentLayoutSpec = `
directives:
  - attribute:
      field: name
      prominent: true
  - attribute:
      field: age
  - attribute:
      field: department
`;

        async function createVisualization(containerId, layoutSpecStr) {
            try {
                // Access the global CndCore object
                const { 
                    JSONDataInstance, 
                    parseLayoutSpec, 
                    LayoutInstance, 
                    SGraphQueryEvaluator,
                    Translators: { WebColaCnDGraph }
                } = window.CndCore;

                const layoutSpec = parseLayoutSpec(layoutSpecStr);
                const instance = new JSONDataInstance(sampleData);
                
                const evaluator = new SGraphQueryEvaluator();
                evaluator.initialize({ sourceData: instance });

                const layoutInstance = new LayoutInstance(layoutSpec, evaluator, 0, true);
                const { layout } = layoutInstance.generateLayout(instance, {});

                // Create and render the graph
                const graphElement = new WebColaCnDGraph();
                graphElement.renderLayout(layout);
                
                const container = document.getElementById(containerId);
                container.innerHTML = '';
                container.appendChild(graphElement);

            } catch (error) {
                console.error(`Error creating visualization for ${containerId}:`, error);
                document.getElementById(containerId).innerHTML = 
                    `<div style="padding: 20px; color: red;">Error: ${error.message}</div>`;
            }
        }

        // Initialize both visualizations when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('CndCore available:', window.CndCore);
            createVisualization('graph-standard', standardLayoutSpec);
            createVisualization('graph-prominent', prominentLayoutSpec);
        });
    </script>
</body>
</html>